# ðŸŽ¯ ANALYZE EXISTING PROJECT - ENHANCED v2.1

**Version:** 2.1 ENHANCED  
**Completeness:** 98/100 (added advanced analysis)  
**Purpose:** Ultimate comprehensive codebase analysis

---

## âœ‚ï¸ **CUT HERE** â¬‡ï¸ (Copy ALL text below until next âœ‚ï¸)

---

ðŸŽ¯ CONTEXT:
I have an EXISTING PROJECT that I want to integrate with .agent v3.0 development system.

I need you to perform an ULTIMATE COMPREHENSIVE ANALYSIS to generate complete PROJECT BRIEF and PROJECT CONVENTIONS documentation.

---

ðŸŽ¯ YOUR ROLE:
You are an elite team of Senior Technical Architects (Backend, Frontend, DevOps, Database, Security, Performance). Your task is to:

1. **ANALYZE** the existing codebase COMPREHENSIVELY (17 categories, 50+ file types)
2. **EXTRACT** all relevant information (tech stack, features, structure, quality, performance, history)
3. **VISUALIZE** complexity, dependencies, and patterns
4. **GENERATE** complete PROJECT-BRIEF.md (9 sections, 100% filled)
5. **CREATE** PROJECT-CONVENTIONS.md (all patterns)
6. **RECOMMEND** .agent integration + performance improvements

---

ðŸ“ PROJECT LOCATION:
[PASTE YOUR PROJECT PATH HERE - Example: c:\Projects\MyExistingApp]

---

ðŸ“– AVAILABLE DOCUMENTATION (Optional):
- README.md: [path or say "Will search"]
- API documentation: [path or say "Will search"]
- Database schema docs: [path or say "Will search"]

---

ðŸ” COMPREHENSIVE ANALYSIS PROTOCOL:

You will perform analysis in **17 CATEGORIES** (12 core + 5 advanced).

---

## CORE CATEGORIES (1-12) - SAME AS v2.0

[ALL 12 categories from v2.0 ULTIMATE prompt - Tech Stack, Routes, Controllers, Models, Migrations, Frontend, Config, Services, Tests, Docs, Quality, Security]

[KEEP EXACT SAME CONTENT AS ANALYZE-EXISTING-PROJECT

.md v2.0]

---

## ðŸš€ ADVANCED CATEGORIES (13-17) - NEW in v2.1

---

## CATEGORY 13: GIT HISTORY & TEAM DYNAMICS

**Commands to Run:**

```bash
# Contributor analysis
git log --pretty=format:"%an" | sort | uniq -c | sort -rn

# Commit frequency
git log --since="3 months ago" --pretty=format:"%ad" --date=short | sort | uniq -c

# Code churn (files changed most often)
git log --pretty=format: --name-only | sort | uniq -c | sort -rn | head -20

# Last commit per file (identify stale files)
git ls-tree -r --name-only HEAD | while read filename; do
  echo "$(git log -1 --format="%ai" -- $filename) $filename"
done | sort
```

**Extract:**

1. **Contributors:**
   - Total contributors
   - Top 3 active contributors (commit count)
   - Recent contributors (last 3 months)
   - Inactive contributors (no commits >6 months)

2. **Commit Patterns:**
   - Average commits/day
   - Most active days (Mon-Sun)
   - Commit frequency trend (increasing/decreasing/stable)
   - Last commit date

3. **Code Churn Hotspots:**
   - Files changed most often (top 10)
   - Why? (bugs? refactoring? active development?)
   - Suggest: Focus testing on these files

4. **Stale Code:**
   - Files not touched in >12 months
   - Candidate for deletion or review

**Output Format:**
```
Git History Analysis:

Contributors (12 total):
  Top 3:
    1. John Doe: 487 commits (40%, primary developer)
    2. Jane Smith: 298 commits (25%, full-stack)
    3. Bob Johnson: 156 commits (13%, backend specialist)
  
  Recent (last 3 months): 5 active contributors
  Inactive (>6 months): 4 contributors

Commit Activity:
  - Total commits: 1,247
  - Average: 3.2 commits/day
  - Most active day: Monday (23% of commits)
  - Trend: Increasing (45 commits/month â†’ 67 commits/month)
  - Last commit: 2026-01-15 (2 days ago) âœ… Active

Code Churn Hotspots (top 10 most-changed files):
  1. app/Http/Controllers/UserController.php (87 commits)
     â†’ High change frequency suggests: Active feature development or bugs
     â†’ Recommendation: Increase test coverage for this controller
  
  2. resources/js/Pages/Dashboard.tsx (64 commits)
     â†’ UI iteration, user feedback incorporated
  
  3. app/Services/UserService.php (52 commits)
     â†’ Core business logic, frequently refined
  
  [... list all 10]

Stale Files (>12 months untouched):
  - app/Http/Controllers/OldReportController.php (last: 2023-03-12)
    â†’ Candidate for deletion or archive
  - resources/views/legacy/** (12 files, last: 2023-06-20)
    â†’ Old Blade views, check if still used

Insights:
  - Active development (commits increasing)
  - 3 core developers carry 78% of commits
  - UserController is hotspot â†’ needs regression testing
  - Legacy code cleanup needed (14 stale files)
```

---

## CATEGORY 14: PERFORMANCE PROFILING

**Files to Check:**

1. **Slow Queries Detection:**
   - Laravel: Check for queries without indexes
   - Look for: `SELECT *`, `WHERE` on non-indexed columns, `LIKE` queries
   - Check for N+1 queries (relationships without eager loading)

2. **Performance Bottlenecks:**
   - Controllers with >300 lines (likely slow)
   - Services with >500 lines (complex logic)
   - Database queries in loops (N+1 problem)
   - API calls in loops (serial requests)

3. **Caching Strategy:**
   - Check for cache usage in controllers/services
   - Look for: Cache::remember(), cache() helper
   - Check for: Query caching, view caching, route caching

**Extract:**

1. **N+1 Query Risks:**
   - Find: Eloquent relationships accessed without `with()`
   - Example: `foreach($users as $user) { $user->posts; }`
   - List all instances

2. **Missing Indexes:**
   - FROM migrations: Check `foreign()` but missing `index()`
   - Check `WHERE`, `ORDER BY`, `JOIN` columns without indexes

3. **Large Payload Risks:**
   - API endpoints returning entire collections (no pagination)
   - SELECT * instead of specific columns

4. **Caching Gaps:**
   - Expensive queries not cached
   - Frequently accessed data not cached

**Output Format:**
```
Performance Analysis:

N+1 Query Risks (8 found):
  1. UserController@index():
     - Line 45: $users = User::all();
     - Line 47: foreach($users as $user) { $user->posts; }
     - Issue: Queries posts for each user (N+1)
     - Fix: User::with('posts')->get();
     - Impact: 100 users = 101 queries â†’ 1 query with eager loading
  
  2. PostController@show():
     - Line 23: $post->comments
     - Issue: Not eager loaded
     - Fix: Post::with('comments')->find($id);
  
  [... list all 8]

Missing Database Indexes (5 potential):
  1. posts table:
     - Column: user_id (foreign key but no index)
     - Query: WHERE user_id = ? (frequent)
     - Recommendation: Add index to user_id
  
  2. posts table:
     - Column: status (used in WHERE often)
     - Recommendation: Add index to status column
  
  [... list all 5]

Large Payload Risks (3 endpoints):
  1. GET /api/users:
     - Returns: ALL users (no pagination)
     - Current: ~2,500 users = 450KB response
     - Recommendation: Add pagination (20 per page)
  
  2. GET /api/posts:
     - Returns: SELECT * (all columns)
     - Unused columns: meta, internal_notes (large text)
     - Recommendation: Return only needed columns
  
  [... list all 3]

Caching Strategy:
  Current: Redis configured âœ…
  Usage: âš ï¸ Underutilized
  
  Cached:
    - User permissions: âœ… Cached (TTL: 60 min)
    - App settings: âœ… Cached (TTL: 24 hours)
  
  NOT Cached (recommendations):
    - User posts count (expensive COUNT query, called often)
      â†’ Cache for 5 minutes
    - Popular posts (complex query with joins)
      â†’ Cache for 15 minutes
    - Category tree (rarely changes)
      â†’ Cache for 1 hour

Performance Estimate:
  - Current avg response time: ~450ms (estimated)
  - After fixes (eager loading + indexes + caching): ~120ms
  - Improvement: 73% faster âš¡
```

---

## CATEGORY 15: DEPENDENCY GRAPH VISUALIZATION

**Analysis:**

1. **Generate Import Graph:**
   - Controllers â†’ Services â†’ Repositories â†’ Models
   - Identify circular dependencies (A imports B, B imports A)
   - Find "God classes" (imported by everything)

2. **Package Dependencies:**
   - FROM composer.json / package.json
   - Identify: Core vs optional dependencies
   - Find: Unused dependencies (imported but never used)

**Output Format:**
```
Dependency Graph:

Service Layer Dependencies:
  UserService:
    â†’ Uses: UserRepository, Mailer, EventDispatcher
    â† Used by: UserController, ProfileController, AdminController
    Complexity: Medium (3 dependencies, 3 dependents)
  
  PostService:
    â†’ Uses: PostRepository, UserService, SlugService, ImageService
    â† Used by: PostController, DashboardController
    Complexity: High (4 dependencies, 2 dependents)
  
  OrderService: âš ï¸ God Class
    â†’ Uses: UserService, ProductService, PaymentService, InventoryService, EmailService
    â† Used by: OrderController, CheckoutController, AdminOrderController, ReportController
    Complexity: Very High (5 dependencies, 4 dependents)
    Issue: Too many responsibilities
    Recommendation: Split into OrderCreationService, OrderFulfillmentService

Circular Dependencies:
  âŒ FOUND: UserService â†” PostService
    - UserService imports PostService (line 12)
    - PostService imports UserService (line 8)
    - Issue: Potential infinite loops, hard to test
    - Fix: Extract shared logic to UserPostInteractionService

Package Dependencies:
  Core (18 packages):
    - laravel/framework: Required âœ…
    - react: Required âœ…
    - axios: Required âœ…
  
  Optional (8 packages):
    - lodash: Used in 45 files âœ…
    - moment: Used in 12 files âœ…
  
  Unused (3 packages): âš ï¸
    - jquery: Installed but never imported
      â†’ Recommendation: Remove (npm uninstall jquery)
    - animate.css: Installed, only used once
      â†’ Recommendation: Replace with Tailwind animations
    - bootstrap: Installed, not used (Tailwind used instead)
      â†’ Recommendation: Remove

Dependency Health:
  - Circular dependencies: 1 (fix required)
  - God classes: 1 (refactor recommended)
  - Unused packages: 3 (cleanup recommended)
```

---

## CATEGORY 16: CODE COMPLEXITY HEATMAP

**Analysis:**

1. **Complexity Score per File:**
   - Calculate cyclomatic complexity (if tools available)
   - OR estimate: Lines / 10 = rough complexity

2. **Identify Hotspots:**
   - Files >500 lines = Red (high complexity)
   - Files 300-500 lines = Yellow (medium)
   - Files <300 lines = Green (good)

**Output Format:**
```
Code Complexity Heatmap:

Controllers (18 files):
  ðŸ”´ HIGH (>300 lines):
    - UserController.php: 487 lines, 15 methods
    - OrderController.php: 412 lines, 18 methods
    â†’ Recommendation: Extract to service layer
  
  ðŸŸ¡ MEDIUM (200-300 lines):
    - PostController.php: 267 lines, 12 methods
    - CommentController.php: 234 lines, 10 methods
    â†’ Acceptable, monitor
  
  ðŸŸ¢ GOOD (<200 lines):
    - 14 other controllers
    â†’ Well-sized âœ…

Services (8 files):
  ðŸ”´ HIGH:
    - OrderService.php: 623 lines, 24 methods
      â†’ Complexity: Very High
      â†’ Recommendation: Split into multiple services
  
  ðŸŸ¡ MEDIUM:
    - UserService.php: 347 lines, 12 methods
    - PostService.php: 289 lines, 10 methods
  
  ðŸŸ¢ GOOD:
    - 5 other services

Overall Health:
  - Red zone: 3 files (need refactoring)
  - Yellow zone: 4 files (watch carefully)
  - Green zone: 30+ files (healthy)
  - Refactor Priority: OrderService, UserController, OrderController
```

---

## CATEGORY 17: API TESTING STRATEGY

**Analysis:**

1. **Endpoint Coverage:**
   - FROM Category 2 (Routes): Total endpoints
   - FROM Category 9 (Tests): Tests covering endpoints
   - Calculate: Test coverage % for API

2. **Integration Test Recommendations:**
   - Critical flows: Auth, checkout, payment
   - Data mutations: CREATE, UPDATE, DELETE
   - Error scenarios: 400, 401, 403, 404, 500

**Output Format:**
```
API Testing Strategy:

Endpoint Test Coverage:
  - Total API endpoints: 24
  - Endpoints with tests: 18
  - Coverage: 75% (18/24)
  - Missing tests: 6 endpoints

Tested Endpoints (18):
  âœ… POST /api/auth/login (AuthTest)
  âœ… POST /api/auth/register (AuthTest)
  âœ… GET /api/users (UserTest)
  âœ… POST /api/users (UserTest)
  [... 14 more]

Untested Endpoints (6): âš ï¸
  âŒ GET /api/posts/{id}/comments
  âŒ POST /api/posts/{id}/publish
  âŒ DELETE /api/comments/{id}
  âŒ GET /api/admin/reports
  âŒ POST /api/admin/settings
  âŒ GET /api/export/users
  â†’ Recommendation: Add integration tests for these

Critical Flows (need integration tests):
  1. User Registration â†’ Email Verification â†’ Login
     Status: âš ï¸ Partial (registration tested, email not tested)
     Recommendation: Add E2E test for full flow
  
  2. Create Post â†’ Publish â†’ View
     Status: âœ… Tested
  
  3. Checkout â†’ Payment â†’ Order Confirmation
     Status: âŒ Not tested
     Recommendation: HIGH PRIORITY - add integration test

Error Scenario Coverage:
  - 400 Bad Request: âœ… Tested (validation errors)
  - 401 Unauthorized: âœ… Tested (auth required)
  - 403 Forbidden: âš ï¸ Partial (2 of 5 protected endpoints)
  - 404 Not Found: âœ… Tested
  - 500 Server Error: âŒ Not tested
    â†’ Recommendation: Add tests for error handling

Performance Testing:
  - Load testing: âŒ Not configured
    â†’ Recommendation: Add k6 or Artillery for load tests
  - Stress testing: âŒ Not configured
  - Target: 100 concurrent users, <500ms response

Security Testing:
  - SQL Injection: âœ… Protected (Eloquent ORM)
  - XSS: âœ… Protected (Laravel escaping)
  - CSRF: âœ… Protected (middleware)
  - Auth bypass: âš ï¸ Needs explicit testing
  - Rate limiting: âŒ Not tested
    â†’ Recommendation: Add rate limit tests
```

---

## ðŸ“‚ OUTPUT: GENERATE 2 FILES + RECOMMENDATIONS

After completing ALL 17 categories, you MUST generate:

### FILE 1: PROJECT-BRIEF.md

[Same as v2.0 - 9 sections, filled with data from all 17 categories]

---

### FILE 2: PROJECT-CONVENTIONS.md

[Same as v2.0 - all patterns documented]

---

### FILE 3 (NEW): PERFORMANCE-OPTIMIZATION-RECOMMENDATIONS.md

Save to: `[PROJECT_ROOT]/.agent/docs/PERFORMANCE-OPTIMIZATION-RECOMMENDATIONS.md`

**Structure:**
```markdown
# PERFORMANCE OPTIMIZATION RECOMMENDATIONS

## Immediate Wins (Can implement in 1-2 days)

1. **Fix N+1 Queries (8 found)**
   - Impact: 70%+ faster page loads
   - Effort: 2-3 hours
   - Priority: HIGH âš¡

2. **Add Missing Indexes (5 recommended)**
   - Impact: 50%+ faster queries
   - Effort: 1 hour
   - Priority: HIGH âš¡

3. **Remove Unused Packages (3 found)**
   - Impact: Smaller bundle size (15% reduction)
   - Effort: 30 minutes
   - Priority: MEDIUM

## Short-term (1-2 weeks)

1. **Implement Caching Strategy**
   - Cache expensive queries
   - Impact: 60%+ faster for cached data
   - Effort: 1 day

2. **Add API Pagination**
   - 3 endpoints return full datasets
   - Impact: 80%+ faster responses
   - Effort: 3 hours

3. **Refactor God Classes**
   - OrderService (623 lines) â†’ split into 3 services
   - Impact: Better maintainability, easier testing
   - Effort: 2 days

## Long-term (1-3 months)

1. **Add Integration Tests**
   - 6 untested endpoints
   - Critical flows not covered
   - Impact: Catch regression bugs
   - Effort: 1 week

2. **Performance Monitoring**
   - Add: New Relic or Scout APM
   - Track: Slow queries, high memory usage
   - Impact: Proactive optimization
   - Effort: 1 day setup + ongoing monitoring

3. **Load Testing**
   - Target: 100 concurrent users
   - Identify bottlenecks before production
   - Effort: 2 days
```

---

## ðŸŽ¯ ENHANCED VALIDATION CHECKLIST

**FILE READING:**
- [ ] All 50+ files read across 17 categories
- [ ] Git history analyzed (commits, contributors, churn)
- [ ] Performance profiling done (N+1, indexes, caching)
- [ ] Dependencies mapped (imports, circular deps, unused)
- [ ] Complexity calculated (heatmap generated)
- [ ] API testing analyzed (coverage, missing tests)

**OUTPUT QUALITY:**
- [ ] PROJECT-BRIEF.md: 100% complete
- [ ] PROJECT-CONVENTIONS.md: All patterns
- [ ] PERFORMANCE-OPTIMIZATION-RECOMMENDATIONS.md: Actionable items
- [ ] All metrics ACTUAL (from real analysis)
- [ ] All recommendations SPECIFIC (not generic)

---

## ðŸ’¡ ENHANCED RBA

[Include comprehensive RBA covering all 17 categories]

---

## ðŸš€ EXECUTION

[Same as v2.0 - systematic analysis, file generation, presentation]

---

### âœ‚ï¸ **CUT HERE** â¬†ï¸

---

**End of ENHANCED v2.1**

**Completeness:** 98/100  
**Categories:** 17 (12 core + 5 advanced)  
**Files Analyzed:** 50+  
**Output:** 3 complete files  
**New Features:** Git history, performance profiling, dependency graphs, complexity heatmap, API testing strategy

---

**Created:** 2026-01-17  
**Version:** 2.1 ENHANCED  
**Status:** Production-ready+
